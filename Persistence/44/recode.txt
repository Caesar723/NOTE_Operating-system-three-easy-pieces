44.0
数据完整性data intehrity
数据保护data protection

44.1
磁盘故障模式-要么在工作，要么完全失败

故障停止fail stop模型

潜在扇区错误latest-sector erroes LSE
	磁头由于某种原因接触到表面（磁头碰撞head crash）

块错误block corruption
	有缺陷的磁盘会将块写在错误的位置
	出现故障时
	磁盘无法报告问题

44.2
处理潜在的扇区错误
利用冗余
在RAID 4-5级中
	会读取其他磁盘
	计算缺失值
	重建reconstruct磁盘

44.3
检测corruption（如何阻止用户读取错误数据，如何知道块是坏的）

校验和checksum
	有一个函数
	该函数以一块数据（4kb块）为输入
	计算这段数据
	产生小数据内容（4b）
	与数据一起储存

常见的校验函数
	用XOR计算（简单）
		每个块进行XOR运算
		将块里的数据进行排列
		每一列进行XOR
		问题：
			一列两个错误就会检测不出
	加法（简单）
		快
		进行二进制补码加法
		如果数据移位，不好

	Fletcher检验（复杂）
		用两个校验字节计算
		s1，s2
		s1=s1+ 一个字节%255
		s2=s2+s1 %255

	循环冗余校验CRC
		将数据块视为大的二进制
		将其除以约定值k
		除好的值为CRC值

如何在系统布局校验和
	基本
		为每个数据块旁边添加一个校验和
	
	别的方法
		将校验和打包到512字节的块中
		有一坨校验和放在一起
		后跟一坨数据块
		效率低
			在更新数据块时
			要先跑到校验块那先更新
			在更新数据块


44.4
使用校验和

客户端在读取数据块时，也会从Cs（D）里读取校验和-储存的校验和（stored checksum）
客户端计算读取的块D上的校验和-计算的校验和（computed checksum）
之后比较stored checksum和computed checksum看看是否相等


44.5
现代磁盘有几种的故障模式，要有不同的解决方法

错误位置写入misdirected write
	它们正确的将数据写入磁盘
	但位置错误

	处理错误写入
		为每个校验和中添加信息
		加物理标识符physical identifier ID
		如disk几，block几
		如果信息不匹配，错误写入发生

冗余时错误检测和恢复的关键


44.6
丢失的写入lost write
当设备通知上层已经完成
但这个数据其实是未持久

处理丢失的写入
	写入验证write verfy/写入后读取read after write
	
		通过写入后立刻读取	
		确保数据在磁盘表面
		此方法慢
	方法二
		在文件系统每个inode和间接块之间
		包含检验和
		如果数据丢失
		inode内的校验和就会无法匹配


44.7
大多数数据很少被访问

磁盘擦净disk scrubbing
	通过定期检查所有的块
	检查校验和是否有效
	典型的系统会每晚或每周安排检查


	